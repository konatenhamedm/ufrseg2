'use strict';const default_template='\n    <div class="modal-header">\n        <h5 class="modal-title" id="exampleModalLabel"</h5>\n            <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                <i aria-hidden="true" class="ki ki-close"></i>\n            </button>\n    </div>\n    <div class="modal-body text-center">\n        <div class="spinner spinner-track spinner-primary mr-15">&nbsp;&nbsp;Chargement des donn\u00e9es...</div>\n        <span></span>\n    </div>\n';
$(document).on("click",".link-view-child",function(n){n.preventDefault();$(".label-infos").find(".view-libelle").slideUp(100);const m=$(this);m.find(".link-icon");const a=m.next(".view-libelle");m.prev(".label-parent");m.hasClass("active-link")?(a.html("").slideUp(100),m.removeClass("active-link")):(m.addClass("active-link"),$.ajax({url:m.attr("href"),beforeSend:function(){},success:function(c){a.slideDown(100).html(c)},error:function(){a.html("Une erreur est survenue lors du chargements des infos");
m.removeClass("active-link")}}))});function load_tab_content(n,m,a,c){a&&c&&(localStorage.setItem(a,m),localStorage.setItem(c,n));$.ajax({url:n,cache:!1,beforeSend:function(){$(`#${m}`).html('<p class="text-center">Chargement des donn\u00e9es</p>')},success:function(e){$(`#${m}`).empty().html(e)},error:function(e,f,h){e=404!=e.status?'<p class="text-center">Erreur interne du serveur</p>':'<p class="text-center">URL introuvable</p>';$(`#${m}`).empty().html(e)}})}
function reload_data_table(n,m){const a=n.find("table").attr("id");$.ajax({url:m,method:"POST",beforeSend:function(){n.find(`#${a}_processing`).show()},success:function(c){n.find(`#${a}`).DataTable().ajax.reload(null,!1)},error:function(c,e){},complete:function(){n.find(`#${a}_processing`).hide()}})}
function reload_page(n,m=0,a=!1,c=null,e=!1,f={},h=null){if(c){const b=$(h?h:".grid-dt-wrapper"),d=b.find("table").attr("id");$(".nav-content-tabs").length?(n=$(".nav-content-tabs").attr("id"),f=`${n}_current_index`.replace("-","_"),e||localStorage.getItem(f),load_tab(n)):$.ajax({url:n,method:"POST",beforeSend:function(){b.find(`#${d}_processing`).show()},success:function(k){b.find(`#${d}`).DataTable().ajax.reload(null,!1)},error:function(k,p){},complete:function(){b.find(`#${d}_processing`).hide()}})}else $("#page-loader").removeClass("display-none"),
f.inner&&f.wrapper?(e=f.inner,f=f.wrapper):(e=".page-content-inner",f="#page-content-wrapper"),console.log(e,f),$(`${e}`).load(`${n} ${f}`,()=>{$("#page-loader").addClass("display-none");init_select2();init_date_picker();if($(".nav-content-tabs").length){var b=$(".nav-content-tabs").attr("id"),d=`${b}_current_index`.replace("-","_");d=localStorage.getItem(d)||m;$(`#${b} li:eq(${d}) a`);load_tab(b)}console.log($("#sw_card_sticky"));KTLayoutStickyCard.init("sw_card_sticky");$(".alert-flash").each(function(){const k=
$(this);k.hasClass("alert-success")?a?k.removeClass("d-none"):k.slideUp(5E3):k.hide()});if(localStorage.getItem("reopen_on_page_load")){const [k,p]=localStorage.getItem("reopen_on_page_load").split("|");$(k).length&&(b=$(k+" li:eq("+p+") a").tab("show"),[,d]=b.get(0).href.split("#"),load_tab_content(b.data("href"),d))}})}
$(function(){function n(a,c){const e=a.find(".modal-content");$.ajax({url:c,beforeSend:function(){e.html(default_template)},success:function(f){e.html(f)},error:function(){e.empty().html('\n                    <div class="alert alert-custom alert-notice alert-light-danger fade show" role="alert">\n                    <div class="alert-icon"><i class="flaticon-warning"></i></div>\n                    <div class="alert-text">Erreur interne du serveur</div>\n                \n                    </div>\n                ')}})}let m=
new Set;$("body").on("hidden.bs.modal",".modal",function(){$(this).removeData("bs.modal")});$(document).on("click",".btn-ajax-etat",function(a){a.preventDefault();const c=$(this);a=c.closest("form");const e={};c.attr("name")&&(e[c.attr("name")]=1);var f=$("#sw__print__zone_data");const h=$(".sw__print__zone_btn"),b=$("#sw__print__pdf_zone"),d=$("#sw__print__grid_zone");var k=a.serializeArray();const p=f.find("#no-data-zone");f={};for(let g of k)k=g.name.match(/\[([a-z]+)\]/i),null!==k&&"_token"!=
k[1]&&(f[k[1]]=g.value);let v=new URLSearchParams(f);a.ajaxSubmit({cache:!1,data:e,beforeSend:()=>{c.addClass("spinner spinner-white spinner-right");b.addClass("d-none");h.addClass("d-none").removeClass("iframe-view");d.addClass("d-none");p.removeClass("d-none").html('<div class="d-flex flex-row justify-content-center tab-loader-text">\n                    <div class="p-2">\n                        <div class="spinner spinner-primary  spinner-track spinner-lg"></div> \n                    </div>\n                    <div class="p-2">Chargement des donn\u00e9es</div>\n                </div>')},
beforeSubmit:function(g,l){c.prop("disabled",!0);if(localStorage.getItem("prevent_submit")==l.attr("name"))return!1},complete:()=>{c.removeClass("spinner spinner-white spinner-right");c.prop("disabled",!1)},success:(g,l,w,z)=>{p.addClass("d-none");1==g.statut?(l=g.gridUrl,g=g.iframeUrl,-1==g.indexOf("?")&&(g+="?"+v),l?(l+="?"+v,g&&(h.removeClass("d-none"),d.removeClass("d-none").load(l),$.ajaxSetup({cache:!1}),b.find("iframe").attr("src",g))):g&&b.removeClass("d-none").find("iframe").attr("src",g)):
(b.find("iframe").removeAttr("src"),p.removeClass("d-none"))},error:g=>{let l="";var w=!1;if(g.responseJSON)if(w=g.responseJSON,g=w.message,w=w.showAlert,Array.isArray(g))for(let z of g)l+=`<p class="mb-0">${z}</p>`;else l=`<p class="mb-0">${g}</p>`;else l="Erreur interne du serveur";w?$alert=Swal.fire({html:l?l:"Erreur interne du serveur",icon:"error"}):p.removeClass("d-none").html(l?l:"Erreur interne du serveur")}})});$(document).on("click",".btn-scan",function(a){a.preventDefault();const c=$(this),
e=c.closest("form");a={};c.attr("name")&&(a[c.attr("name")]=1);$.ajax({url:scan_url,cache:!1,data:a,dataType:"json",method:"POST",beforeSend:()=>{c.addClass("spinner spinner-white spinner-right");c.prop("disabled",!0)},complete:()=>{c.removeClass("spinner spinner-white spinner-right");c.prop("disabled",!1)},success:f=>{if(1==f.statut){f=f.message;const h=f.id;e.find(".file-scan").val(h);e.find(".pdf-preview").attr("src",f.url)}},error:f=>{let h="";var b=!1;if(f.responseJSON)if(b=f.responseJSON,f=
b.message,b=b.showAlert,Array.isArray(f))for(let d of f)h+=`<p class="mb-0">${d}</p>`;else h=`<p class="mb-0">${f}</p>`;else h="Erreur interne du serveur";b?$alert=Swal.fire({html:h?h:"Erreur interne du serveur",icon:"error"}):console.log(h?h:"Erreur interne du serveur")}})});$(document).on("click",".btn-ajax",function(a){a.preventDefault();const c=$(this),e=c.closest("form");e.attr("id");const f=c.closest(".modal");c.data("nav");let h;c.hasClass("wrapper-has-blocker")&&(h=$(".has-block-ui").attr("id"));
a={};c.attr("name")&&(a[c.attr("name")]=1);e.ajaxSubmit({cache:!1,data:a,beforeSend:()=>{c.hasClass("btn-inner-ajax")||$(".ajax-content").html("");h&&KTApp.block("#"+h,{overlayColor:"red",opacity:.1,message:$("#"+h).data("loadingtext"),state:"primary"});c.addClass("spinner spinner-white spinner-right")},beforeSubmit:function(b,d){c.prop("disabled",!0);if(localStorage.getItem("prevent_submit")==d.attr("name"))return!1},complete:()=>{c.removeClass("spinner spinner-white spinner-right");c.prop("disabled",
!1);h&&KTApp.unblock("#"+h)},success:(b,d,k,p)=>{var v=Object.keys(b);let g=b.message;const l=b.redirect;d=b.actions;const w=b.ajaxContainer,z=b.gridWrapper;var x=b.url;const A=b.tabId;k=b.closeBtn;const B=b.pushDgr,F=b.pushData,G=b.vals||{};var C=0<=v.indexOf("reloadPage")?b.reloadPage:!0;v=0<=v.indexOf("showAlert")?b.showAlert:!1;if(b.statut){var t=$(".ajax-success",p);for(q of Object.keys(G))console.log(q,$(".val-"+q)),$(".val-"+q).val(setValue(G[q]));F&&$.ajax({url:Routing.generate("push_exploitation",
{type:F.discr},!0),type:"POST",data:F.data,dataType:"json"});B&&$.ajax({url:Routing.generate("push_dossier_degroupage",{type:B.type},!0),type:"POST",data:B.data,dataType:"json",error:function(){{var r=B.data,u=r.current;const D=u.etat;var y=r.groupe;const H=$(`[href="#${D}"]`);r=r.updates;y=`subParamLinksTabDegroupage-${y}-${D}`;const I=$("#"+y).find(".active").attr("data-etat");H.length&&H.find(".counter-number").text(u.stats.count);for(const E of Object.keys(r))$(`[href="#${E}"]`).find(".counter-number").text(r[E].count),
u="subParamLinksTabDegroupage-"+r[E].groupe+"-"+E,$("#"+u).length&&load_tab(u);D==I&&load_tab(y)}}});b.message&&!v&&t.removeClass("d-none").find(".alert-text").html(b.message);$(".ajax-error",p).addClass("d-none").find(".alert-text").html("");if(b.data||!l||-1===l.indexOf("#modal")){l&&f.length&&!1!==b.modal&&f.modal("hide");var q=new Promise((r,u)=>r());v&&(q=Swal.fire({html:b.message,icon:"success"}));x&&A?(t=x.tab,q=x.current_tab,t=$("#"+A).find('[href="'+t+'"]'),C=t.parent("li"),C.removeClass("d-none"),
t.data("href")||t.attr("data-href",x.url),load_tab(A,null,C.index()),q&&q.url&&q.tab&&(x=$("#"+A).find('[href="'+q.tab+'"]'),x.removeData("href"),x.attr("data-href",q.url))):b.fullRedirect?q.then(()=>document.location.href=l):(l&&!d&&C&&q.then(()=>reload_page(l,0,b.persistFlash,b.data,!1,w,z)),b.message&&$(window).scrollTop(t.position().top));if(d&&"defined"!=typeof d.action)switch(d.action){case "switch_tab":load_tab(d.target,null,d.index);break;case "reload_modal":n($(`${d.target}`),b.redirect);
break;case "remove_assigned":x=$(`${d.target}`).find('[href="#'+d.etat+'"]');0==d.count&&x.find(".label-dot").remove();reload_page(l,0,b.persistFlash,b.data,!1,w,z);break;case "reload_fragment":$(`${d.fragment}`).html(`${d.content}`)}k&&c.remove()}else{v&&(q=Swal.fire("",b.message,"success"));let [,r]=l.split("#");r=r.replace("modal","");modals_array=Array.from(m);let u=0;modals_array.forEach((y,D)=>{y.id==r&&--u});$("#"+r).modal("hide");$("#"+modals_array[0]).addClass("reload-page");$("#"+modals_array[0<=
u?u:0])}f.scrollTop($(".ajax-success",p).position().top)}else{d="";if(Array.isArray(g)){g=[...new Set(g)];for(t of g)d+=`<p class="mb-0">${t}</p>`}else d=`<p class="mb-0">${g}</p>`;$(".ajax-error",p).removeClass("d-none").find(".alert-text").html(d);$(".ajax-success",p).addClass("d-none").find(".alert-text").html("");f.scrollTop($(".ajax-error",p).position().top);$(window).scrollTop($(".ajax-error",p).position().top)}},error:b=>{let d="";var k=!1;if(b.responseJSON)if(k=b.responseJSON,b=k.message,
k=k.showAlert,Array.isArray(b))for(let p of b)d+=`<p class="mb-0">${p}</p>`;else d=`<p class="mb-0">${b}</p>`;else d="Erreur interne du serveur";k?$alert=Swal.fire({html:d?d:"Erreur interne du serveur",icon:"error"}):($(".ajax-error",e).removeClass("d-none").find(".alert-text").html(d?d:"Erreur interne du serveur"),$(".ajax-success",e).addClass("d-none").find(".alert-text").html(""));$(".ajax-error").length&&f.scrollTop($(".ajax-error").position().top)}})}).on("click",".button-ajax",function(a){a.preventDefault();
const c=$(this);a=c.closest("form");a.attr("id");a.ajaxSubmit({cache:!1,beforeSend:()=>{c.addClass("spinner spinner-white spinner-right")},complete:()=>{c.removeClass("spinner spinner-white spinner-right")},success:(e,f,h,b)=>{e.statut&&(console.log(e.entity),table.row.add([e.entity.code,e.entity.libelle]).draw(!1),b[0].reset())},error:e=>{}})}).on("click",".prevent-default",function(a){a.preventDefault()}).on("click",".link-param",function(a){});$(".modal").on("hide.bs.modal",function(a){const c=
$(this);$(a.target).hasClass("no-ajax")||(c.closest(".note-editor").length||(m.delete(c.attr("id")),c.find(".modal-content").html("").append('\n                    <div class="modal-header">\n                        <h5 class="modal-title" id="exampleModalLabel"</h5>\n                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                            <i aria-hidden="true" class="ki ki-close"></i>\n                        </button>\n                    </div>\n                    <div class="modal-body text-center">\n                        <div class="spinner spinner-track spinner-primary mr-15">&nbsp;&nbsp;Chargement des donn\u00e9es...</div>\n                        <span></span>\n                    </div>\n                '),
c.hasClass("reload-page")&&(c.removeClass("reload-page"),reload_page(current_url),$(".alert-flash").remove())),a=document.location.hash,0===a.indexOf("#modal-ref")&&(document.location.hash=""),0===a.indexOf("#sendMail")&&(document.location.hash=""))});$(".modal").on("show.bs.modal",function(a){a=$(a.relatedTarget);const c=$(this);c.data("options");a.attr("href")&&"#"!=a.attr("href")[0]&&c.find(".modal-content").load(a.attr("href"));a.attr("data-href")&&c.find(".modal-content").load(a.attr("data-href"))});
$(".menu-item-active").closest(".current_ancestor").addClass("menu-item-open");$("body").each(function(){var a=$(this).attr("data-current-menu");a&&(a=$("."+a).closest("li"),a.addClass("menu-item-active"),a.closest(".menu-submenu").closest("li").addClass("menu-item-open menu-item-here"))});$(document).ajaxError(function(a,c,e){c=e.type;e=e.dataType;a=$(a.currentTarget.activeElement);a.find(".modal-body")&&"get"==c.toLowerCase()&&"html"==e&&(a.find(".modal-title").text("Erreur"),a.find(".modal-content").html(' <div class="modal-header">\n            <h5 class="modal-title" id="exampleModalLabel">Erreur</h5>\n            <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                <i aria-hidden="true" class="ki ki-close"></i>\n            </button>\n        </div>\n        <div class="modal-body">\n            <div class="alert alert-custom alert-notice alert-light-danger fade show" role="alert">\n                <div class="alert-icon"><i class="flaticon-warning"></i></div>\n                <div class="alert-text">Une erreur est survenue</div>\n            </div>\n        </div>\n        <div class="modal-footer">\n            <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>\n        </div>'))})});